<html>
  <head>
    <title>karras.entity API reference (karras)</title>
    <link href="static/favicon.png" rel="icon" />
    <link href="static/favicon.png" rel="shortcut icon" />
    <link media="all" type="text/css" href="static/clojure.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/wiki.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/internal.css" rel="stylesheet" />
    <!-- TODO: are we using these (from clojure.org)? If so, add the files -->
    <script src="file/view/code_highlighter.js" type="text/javascript"></script>
    <script src="file/view/clojure.js" type="text/javascript"></script>
    <style>.menuWrapper{height: 36px;}</style>
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="http://www.wikispaces.com/_/2009051601/s/internal_ie.css" type="text/css" />
    <![endif]-->
  </head>
<!--
This document was auto-generated from the source by the clojure autodoc system.
To report errors or ask questions about the overall documentation structure, formatting,
etc., contact Tom Faulhaber (google mail name: tomfaulhaber).
For errors in the documentation of a particular namespace, contact the author of that
namespace.
-->
  <body>
    <div id="AllContentContainer">
      <div id="Header">
	<a id="Logo" href="index.html"><img alt="Clojure" height="100" width="100" src="static/clojure-icon.gif" /></a>
	<h1><a title="page header title" id="page-header" href="index.html">karras</a></h1>
      </div>
      <div id="leftcolumn"><div style="text-align: center;"></div>
<div class="menu">
  <div class="WikiCustomNav WikiElement wiki">
    <a class="wiki_link" href="index.html">Overview</a><br />
    <a class="wiki_link" href="api-index.html">API Index</a><br />
    <a class="wiki_link" href="#">Namespaces:</a>
    <ul id="left-sidebar-list">
      <li><a href="karras.collection-api.html" class="wiki_link">karras.collection</a></li><li><a href="karras.core-api.html" class="wiki_link">karras.core</a></li><li><a href="karras.entity-api.html" class="wiki_link">karras.entity</a></li><li><a href="karras.example-api.html" class="wiki_link">karras.example</a></li><li><a href="karras.sugar-api.html" class="wiki_link">karras.sugar</a></li>
    </ul>
  </div>
</div>
</div>
      <div id="rightcolumn">
	<div id="Content">
	  <div class="contentBox"><div class="innerContentBox">
              <div id="content_view" class="wiki wikiPage">
                <div id="right-sidebar"><div id="toc">
  <h1 class="nopad">Table of Contents</h1>
  <div style="margin-left: 1em;" class="toc-section">
    <a href="#toc0">Overview</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/add-reference">add-reference</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/collection-for">collection-for</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/convert">convert</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/count-instances">count-instances</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/create">create</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/defaggregate">defaggregate</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/defentity">defentity</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/deffetch">deffetch</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/deffetch-one">deffetch-one</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/delete">delete</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/delete-all">delete-all</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/distinct-values">distinct-values</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/ensure-indexes">ensure-indexes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/ensure-type">ensure-type</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/entity-spec">entity-spec</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/entity-spec-assoc">entity-spec-assoc</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/entity-spec-get">entity-spec-get</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/entity-spec-get-in">entity-spec-get-in</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/entity-spec-of">entity-spec-of</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/entity-spec-of-item">entity-spec-of-item</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/fetch">fetch</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/fetch-all">fetch-all</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/fetch-by-id">fetch-by-id</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/fetch-map-reduce-values">fetch-map-reduce-values</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/fetch-one">fetch-one</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/fetch-refers-to">fetch-refers-to</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/field-spec-of">field-spec-of</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/find-and-modify">find-and-modify</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/find-and-remove">find-and-remove</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/get-reference">get-reference</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/grab">grab</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/grab-in">grab-in</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/group">group</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/index">index</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/list-indexes">list-indexes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/make">make</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/map-reduce">map-reduce</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/map-reduce-fetch-all">map-reduce-fetch-all</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/relate">relate</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/save">save</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/set-reference">set-reference</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/swap-entity-spec-in!">swap-entity-spec-in!</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/update">update</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity/update-all">update-all</a>
    </div>
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#karras.entity.testing">karras.entity.testing</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.entity.testing/entity-fixture">entity-fixture</a>
    </div>
    <br />
  </div>
</div>
</div>
                <div id="content-tag"><h1 id="overview">API for <span id="namespace-name">karras.entity</span></h1>
by <span id="author">Wilkes Joiner</span><br />
<br />Usage:
<pre>
(ns your-namespace
  (:require <span id="long-name">karras.entity</span>))
</pre><pre>
</pre><h2>Overview</h2>
<pre id="namespace-docstr">
A library for defining entities and aggregates.  Entities correspond to a mongo entity.
Aggregates correspond to a an embedded entity.

Example:

  (defaggregate Address [:street :city :state :zip])

  (defaggregate Phone [:area-code :number]

  (defentity Person
    [:first-name 
     :last-name
     :address {:type Address}
     :phones {:type :list :of Phone}])</pre>
<br />
<h2>Public Variables and Functions</h2>
<div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/add-reference">add-reference</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (add-reference entity k &amp; vs)
</pre>
  <pre id="var-docstr">Add one more :_id's to a sequence of the given key</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L328" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/collection-for">collection-for</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (collection-for entity-or-type)
</pre>
  <pre id="var-docstr">Returns the DBCollection for the supplied entity instance or type.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L170" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/convert">convert</h2>
  <span id="var-type">multimethod</span><br />
  <pre id="var-usage">No usage documentation available</pre>
  <pre id="var-docstr">Multimethod used to convert a entity.
Takes in a field-spec and a val and returns the conver
Dispatches off of :type key of first arg.
:default returns the value unmodified</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L65" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/count-instances">count-instances</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (count-instances type)
       (count-instances type criteria)
</pre>
  <pre id="var-docstr">Return the number of entities optionally matching a given where clause.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L252" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/create">create</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (create type hmap)
</pre>
  <pre id="var-docstr">Makes a new instance of type and saves it.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L194" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/defaggregate">defaggregate</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (defaggregate classname [&amp; fields] &amp; type-fns)
</pre>
  <pre id="var-docstr">Defines an aggregate type that can be embedded into an entity.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L127" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/defentity">defentity</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (defentity classname [&amp; fields] &amp; type-fns)
</pre>
  <pre id="var-docstr">Defines an entity that corresponds to a collection.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L122" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/deffetch">deffetch</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (deffetch type fn-name [&amp; args] &amp; criteria)
</pre>
  <pre id="var-docstr">Defines a fetch function for the given type. 
The function created takes all of the options of fetch plus an :and option to append to the where clause.

Usage:
  (defentity Person [:first-name :last-name :age]
     (deffetch adults [] (gte :age 18))
     (deffetch peope-in-age-range [min max] (within :age min max)))

Outside of defentity:
  (deffetch Person teenagers [] (within :age 13 19))

Give me all the teenagers with last names A-J sorted by last name:
  (teenagers :and (within :last-name "A" "J") :sort [(asc :last-name)])

Give me the youngest 10 people between the ages of 21 and 100 sorted by age and last name:      
  (peope-in-age-range 21 100 :limit 10 :sort [(asc :age) (asc :last-name)])</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L428" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/deffetch-one">deffetch-one</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (deffetch-one type fn-name [&amp; args] &amp; criteria)
</pre>
  <pre id="var-docstr">Defines a fetch-one function for the given type. 
The function created takes all of the options of fetch-one plus an :and option to append to the where clause.

Usage:
  (defentity Person [:first-name :last-name :age]
     (deffetch-one person-by-fullname
       [first-name last-name]
       (eq :first-name first-name)
       (eq :last-name last-name)))

Fetch a person by name:
  (person-by-name "John" "Smith")</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L448" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/delete">delete</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (delete entity)
       (delete entity &amp; entities)
</pre>
  <pre id="var-docstr">Deletes one or more entities.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L222" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/delete-all">delete-all</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (delete-all type)
       (delete-all type where)
</pre>
  <pre id="var-docstr">Deletes all entitys given an optional where clause.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L215" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/distinct-values">distinct-values</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (distinct-values type kw)
</pre>
  <pre id="var-docstr">Return the distinct values of a given type for a given key.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L259" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/ensure-indexes">ensure-indexes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (ensure-indexes)
       (ensure-indexes type)
</pre>
  <pre id="var-docstr">Ensure the indexes are built, optionally for a given type. Defaults to all types.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L310" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/ensure-type">ensure-type</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (ensure-type type entity)
</pre>
  <pre id="var-docstr">Force an entity to be of a given type if is not already.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L178" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/entity-spec">entity-spec</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (entity-spec type)
</pre>
  <pre id="var-docstr">Lookup the EntitySpec for a given type</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L34" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/entity-spec-assoc">entity-spec-assoc</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (entity-spec-assoc type &amp; kvs)
</pre>
  <pre id="var-docstr">Associate the suppled keys and values with the entity-spec for the given type.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L156" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/entity-spec-get">entity-spec-get</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (entity-spec-get type key &amp; [default])
</pre>
  <pre id="var-docstr">Lookup the EntitySpec value for given key of the given type.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L39" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/entity-spec-get-in">entity-spec-get-in</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (entity-spec-get-in type path)
</pre>
  <pre id="var-docstr">Lookup the EntitySpec value for given key of the given type.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L44" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/entity-spec-of">entity-spec-of</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (entity-spec-of type &amp; keys)
</pre>
  <pre id="var-docstr">Given a type and one or more keys,
lookup of the entity-spec for the :type of the last field supplied.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L144" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/entity-spec-of-item">entity-spec-of-item</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (entity-spec-of-item type &amp; keys)
</pre>
  <pre id="var-docstr">Given a type and one or more keys,
lookup of the entity-spec for the :of of the last field supplied.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L150" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/fetch">fetch</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (fetch type criteria &amp; options)
</pre>
  <pre id="var-docstr">Fetch a seq of entities for the given type matching the supplied parameters.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L229" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/fetch-all">fetch-all</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (fetch-all type &amp; options)
</pre>
  <pre id="var-docstr">Fetch all of the entities for the given type.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L234" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/fetch-by-id">fetch-by-id</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (fetch-by-id entity)
       (fetch-by-id type id)
</pre>
  <pre id="var-docstr">Fetch an enity by :_id</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L244" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/fetch-map-reduce-values">fetch-map-reduce-values</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (fetch-map-reduce-values map-reduce-result &amp; fetch-options)
</pre>
  <pre id="var-docstr">Takes the result of map-reduce and fetches the values. Takes the same options as fetch.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L295" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/fetch-one">fetch-one</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (fetch-one type criteria &amp; options)
</pre>
  <pre id="var-docstr">Fetch the first entity for the given type matching the supplied criteria and options.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L239" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/fetch-refers-to">fetch-refers-to</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (fetch-refers-to entity referrer-type referrer-field &amp; options)
</pre>
  <pre id="var-docstr">Given an entity, a type and a field, fetch all the entities of the given type
that refer to the given entity. Takes the same options as fetch. </pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L404" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/field-spec-of">field-spec-of</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (field-spec-of type &amp; keys)
</pre>
  <pre id="var-docstr">Given a type and one or more keys,
returns the field spec for the last key.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L132" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/find-and-modify">find-and-modify</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (find-and-modify type criteria modifier &amp; options)
</pre>
  <pre id="var-docstr">See <a href="http://www.mongodb.org/display/DOCS/findandmodify+Command">http://www.mongodb.org/display/DOCS/findandmodify+Command</a></pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L280" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/find-and-remove">find-and-remove</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (find-and-remove type criteria &amp; options)
</pre>
  <pre id="var-docstr">See <a href="http://www.mongodb.org/display/DOCS/findandmodify+Command">http://www.mongodb.org/display/DOCS/findandmodify+Command</a></pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L285" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/get-reference">get-reference</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (get-reference entity k)
</pre>
  <pre id="var-docstr">Fetch the entity or entities referrenced by the given key.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L346" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/grab">grab</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (grab parent k &amp; [refresh])
</pre>
  <pre id="var-docstr">Analogous to clojure.core/get except that it will follow references.
References are cached in a :cache atom of the references metadata.
Takes an optional refresh flag to force it to fetch the reference.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L356" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/grab-in">grab-in</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (grab-in parent ks &amp; refresh)
</pre>
  <pre id="var-docstr">Analogous to clojure.core/get-in except that it will follow references.
References are cached in a :cache atom of the references metadata.
Takes an optional refresh flag to force it to fetch any references
along the path.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L371" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/group">group</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (group type keys)
       (group type keys cond initial reduce)
       (group type keys cond initial reduce finalize)
</pre>
  <pre id="var-docstr">Fetch a seq of grouped items.
Example:
  SQL: select a,b,sum(c) csum from coll where active=1 group by a,b
  Karras: (group MyType
                 [:a :b] 
                 {:active 1}
                 {:csum 0}
                 "function(obj,prev) { prev.csum += obj.c; }")</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L264" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/index">index</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (index type &amp; keys)
</pre>
  <pre id="var-docstr">Associate an index with a give type.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L305" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/list-indexes">list-indexes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (list-indexes type)
</pre>
  <pre id="var-docstr"></pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L319" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/make">make</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (make type hmap &amp; [no-defaults])
</pre>
  <pre id="var-docstr">Converts a hashmap to the supplied type.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L88" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/map-reduce">map-reduce</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (map-reduce type mapfn reducefn &amp; options)
</pre>
  <pre id="var-docstr">See <a href="http://www.mongodb.org/display/DOCS/MapReduce">http://www.mongodb.org/display/DOCS/MapReduce</a></pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L290" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/map-reduce-fetch-all">map-reduce-fetch-all</h2>
  <span id="var-type">var</span><br />
  <pre id="var-usage"></pre>
  <pre id="var-docstr">Composes map-reduce and fetch-map-reduce-values and returns all the results.
If you need to filter the results use:
  (fetch-map-reduce-values (map-reduce ...) ...your fetch options...</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L300" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/relate">relate</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (relate parent k &amp; vs)
</pre>
  <pre id="var-docstr">Relates an entity to another entity as a reference. Returns the parent with
the reference associated.  No-op if the target field is not a :reference or 
:references. If the the key is a list it will add the reference, otherwise it
will set the reference. References are automatically saved if they haven't 
been already. References are stored on the entity as:
  {:_db "db-name" :_id ObjectId :_ref "collection-name")}</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L379" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/save">save</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (save entity)
       (save entity &amp; entities)
</pre>
  <pre id="var-docstr">Inserts or updates one or more entities.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L185" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/set-reference">set-reference</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (set-reference entity k v)
</pre>
  <pre id="var-docstr">Set an :_id to the key of the given entity</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L339" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/swap-entity-spec-in!">swap-entity-spec-in!</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (swap-entity-spec-in! type attribute-path f &amp; args)
</pre>
  <pre id="var-docstr">Combines swap! and assoc-in to modify the attribute of a entity-spec.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L161" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/update">update</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (update type criteria modifiers &amp; options)
</pre>
  <pre id="var-docstr">Updates one or more documents in a collection that match the criteria with the document 
provided.
  :upsert, performs an insert if the document doesn't have :_id
  :multi, update all documents that match the criteria
If working with an instance of an entity, use the save function.</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L199" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.entity/update-all">update-all</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (update-all type obj)
       (update-all type criteria obj)
</pre>
  <pre id="var-docstr">Shortcut for (update type criteria obj :multi)</pre>
  <a href="http://github.com/wilkes/karras/blob/3a257d9cf2e9236e884fffe7958cb912978ab654/src/karras/entity.clj#L208" id="var-source">Source</a>
</div>
<h2 id="namespace-name">karras.entity.testing</h2>
<pre id="namespace-docstr"></pre>
<br />
<div id="var-entry">
  <hr />
  <h2 id="karras.entity.testing/entity-fixture">entity-fixture</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (entity-fixture db)
</pre>
  <pre id="var-docstr">creates a test fixture that wraps tests in a with-mongo-request and drops 
all the colllections for the known entities.</pre>
  <a href="http://github.com/wilkes/karras/blob/e5f885ef8886684c9ccae1f6f01b5ba9e57a5670/src/karras/entity/testing.clj#L6" id="var-source">Source</a>
</div>


</div>
              </div>
            </div>
          </div>
	</div>
	<div id="foot">
	  <div style="text-align: center;" id="copyright">No copyright info </div>
	</div>
      </div>
      <div id="DesignedBy">Logo &amp; site design by <a title="Visit Tom Hickey's website." href="http://www.tomhickey.com">Tom Hickey</a>.<br />
      Clojure auto-documentation system by Tom Faulhaber.</div>
    </div>
    <!-- /AllContentContainer -->
  </body>

</html>