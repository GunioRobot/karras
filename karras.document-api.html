<html>
  <head>
    <title>karras.document API reference (karras)</title>
    <link href="static/favicon.png" rel="icon" />
    <link href="static/favicon.png" rel="shortcut icon" />
    <link media="all" type="text/css" href="static/clojure.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/wiki.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/internal.css" rel="stylesheet" />
    <!-- TODO: are we using these (from clojure.org)? If so, add the files -->
    <script src="file/view/code_highlighter.js" type="text/javascript"></script>
    <script src="file/view/clojure.js" type="text/javascript"></script>
    <style>.menuWrapper{height: 36px;}</style>
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="http://www.wikispaces.com/_/2009051601/s/internal_ie.css" type="text/css" />
    <![endif]-->
  </head>
<!--
This document was auto-generated from the source by the clojure autodoc system.
To report errors or ask questions about the overall documentation structure, formatting,
etc., contact Tom Faulhaber (google mail name: tomfaulhaber).
For errors in the documentation of a particular namespace, contact the author of that
namespace.
-->
  <body>
    <div id="AllContentContainer">
      <div id="Header">
	<a id="Logo" href="index.html"><img alt="Clojure" height="100" width="100" src="static/clojure-icon.gif" /></a>
	<h1><a title="page header title" id="page-header" href="index.html">karras</a></h1>
      </div>
      <div id="leftcolumn"><div style="text-align: center;"></div>
<div class="menu">
  <div class="WikiCustomNav WikiElement wiki">
    <a class="wiki_link" href="index.html">Overview</a><br />
    <a class="wiki_link" href="api-index.html">API Index</a><br />
    <a class="wiki_link" href="#">Namespaces:</a>
    <ul id="left-sidebar-list">
      <li><a href="karras.collection-api.html" class="wiki_link">karras.collection</a></li><li><a href="karras.core-api.html" class="wiki_link">karras.core</a></li><li><a href="karras.document-api.html" class="wiki_link">karras.document</a></li><li><a href="karras.example-api.html" class="wiki_link">karras.example</a></li><li><a href="karras.sugar-api.html" class="wiki_link">karras.sugar</a></li><li><a href="karras.validations-api.html" class="wiki_link">karras.validations</a></li>
    </ul>
  </div>
</div>
</div>
      <div id="rightcolumn">
	<div id="Content">
	  <div class="contentBox"><div class="innerContentBox">
              <div id="content_view" class="wiki wikiPage">
                <div id="right-sidebar"><div id="toc">
  <h1 class="nopad">Table of Contents</h1>
  <div style="margin-left: 1em;" class="toc-section">
    <a href="#toc0">Overview</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/EntityCallbacks">EntityCallbacks</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/add-reference">add-reference</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/collection-for">collection-for</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/convert">convert</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/count-instances">count-instances</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/create">create</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/defaggregate">defaggregate</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/defentity">defentity</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/defscope">defscope</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/delete">delete</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/delete-all">delete-all</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/distinct-values">distinct-values</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/docspec">docspec</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/docspec-assoc">docspec-assoc</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/docspec-of">docspec-of</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/docspec-of-item">docspec-of-item</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/docspec-value">docspec-value</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/ensure-indexes">ensure-indexes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/ensure-type">ensure-type</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/fetch">fetch</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/fetch-all">fetch-all</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/fetch-one">fetch-one</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/field-spec-of">field-spec-of</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/get-reference">get-reference</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/index">index</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/list-indexes">list-indexes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/make">make</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/save">save</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/set-reference">set-reference</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#karras.document/update">update</a>
    </div>
    <br />
  </div>
</div>
</div>
                <div id="content-tag"><h1 id="overview">API for <span id="namespace-name">karras.document</span></h1>
by <span id="author">Wilkes Joiner</span><br />
<br />Usage:
<pre>
(ns your-namespace
  (:require <span id="long-name">karras.document</span>))
</pre><pre>
</pre><h2>Overview</h2>
<pre id="namespace-docstr">
A library for defining entities and aggregates.  Entities correspond to a mongo document.
Aggregates correspond to a an embedded document.

Example:

  (defaggregate Address [:street :city :state :zip])

  (defaggregate Phone [:area-code :number]

  (defentity Person
    [:first-name 
     :last-name
     :address {:type Address}
     :phones {:type :list :of Phone}])</pre>
<br />
<h2>Public Variables and Functions</h2>
<div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/EntityCallbacks">EntityCallbacks</h2>
  <span id="var-type">var</span><br />
  <pre id="var-usage"></pre>
  <pre id="var-docstr">Lifecycle callbacks for Entities.
 All of these are required to take in an entity and return an entity.

(before-create [e])
(before-delete [e])
(before-save [e])
(before-update [e])
(after-create [e])
(after-delete [e])
(after-save [e])
(after-update [e])</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/add-reference">add-reference</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (add-reference entity k &amp; vs)
</pre>
  <pre id="var-docstr">Add one more :_id's to a sequence of the given key</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/collection-for">collection-for</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (collection-for entity-or-type)
</pre>
  <pre id="var-docstr">Returns the DBCollection for the supplied entity instance or type.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/convert">convert</h2>
  <span id="var-type">multimethod</span><br />
  <pre id="var-usage">No usage documentation available</pre>
  <pre id="var-docstr">Multimethod used to convert a document.
Takes in a field-spec and a val and returns the conver
Dispatches off of :type key of first arg.
:default returns the value unmodified</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/count-instances">count-instances</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (count-instances type)
       (count-instances type query)
</pre>
  <pre id="var-docstr">Return the number of documents optionally matching a given where clause.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/create">create</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (create type hmap)
</pre>
  <pre id="var-docstr">Makes a new instance of type and saves it.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/defaggregate">defaggregate</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (defaggregate classname [&amp; fields] &amp; type-fns)
</pre>
  <pre id="var-docstr">Defines an aggregate type that can be embedded into an entity.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/defentity">defentity</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (defentity classname [&amp; fields] &amp; type-fns)
</pre>
  <pre id="var-docstr">Defines an entity that corresponds to a collection.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/defscope">defscope</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (defscope type fn-name [&amp; args] &amp; where-clauses)
</pre>
  <pre id="var-docstr">Defines a fetch function for the given type. 
The function created takes all of the options of fetch plus an :and option to append to the where clause.

Usage:
  (defentity Person [:first-name :last-name :age]
     (defscope adults [] (gte :age 18))
     (defscope peope-in-age-range [min max] (within :age min max)))

Outside of defentity:
  (defscope Person teenagers [] (within :age 13 19))

Give me all the teenagers with last names A-J sorted by last name:
  (teenagers :and (within :last-name "A" "J") :sort [(asc :last-name)])

Give me the youngest 10 people between the ages of 21 and 100 sorted by age and last name:      
  (peope-in-age-range 21 100 :limit 10 :sort [(asc :age) (asc :last-name)])</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/delete">delete</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (delete entity)
       (delete entity &amp; entities)
</pre>
  <pre id="var-docstr">Deletes one or more entities.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/delete-all">delete-all</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (delete-all type)
       (delete-all type where)
</pre>
  <pre id="var-docstr">Deletes all documents given an optional where clause.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/distinct-values">distinct-values</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (distinct-values type kw)
</pre>
  <pre id="var-docstr">Return the distinct values of a given type for a given key.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/docspec">docspec</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (docspec type)
</pre>
  <pre id="var-docstr">Lookup the DocSpec for a given type</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/docspec-assoc">docspec-assoc</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (docspec-assoc type &amp; kvs)
</pre>
  <pre id="var-docstr">Associate the suppled keys and values with the docspec for the given type.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/docspec-of">docspec-of</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (docspec-of type &amp; keys)
</pre>
  <pre id="var-docstr">Given a type and one or more keys,
lookup of the docspec for the :type of the last field supplied.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/docspec-of-item">docspec-of-item</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (docspec-of-item type &amp; keys)
</pre>
  <pre id="var-docstr">Given a type and one or more keys,
lookup of the docspec for the :of of the last field supplied.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/docspec-value">docspec-value</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (docspec-value type key &amp; [default])
</pre>
  <pre id="var-docstr">Lookup the DocSpec value for given key of the given type.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/ensure-indexes">ensure-indexes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (ensure-indexes)
       (ensure-indexes type)
</pre>
  <pre id="var-docstr">Ensure the indexes are built, optionally for a given type. Defaults to all types.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/ensure-type">ensure-type</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (ensure-type type entity)
</pre>
  <pre id="var-docstr">Force an entity to be of a given type if is not already.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/fetch">fetch</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (fetch type query &amp; options)
</pre>
  <pre id="var-docstr">Fetch a seq of documents for the given type matching the supplied parameters.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/fetch-all">fetch-all</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (fetch-all type &amp; options)
</pre>
  <pre id="var-docstr">Fetch all of the documents for the given type.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/fetch-one">fetch-one</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (fetch-one type query &amp; options)
</pre>
  <pre id="var-docstr">Fetch the first document for the given type matching the supplied query and options.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/field-spec-of">field-spec-of</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (field-spec-of type &amp; keys)
</pre>
  <pre id="var-docstr">Given a type and one or more keys,
returns the field spec for the last key.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/get-reference">get-reference</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (get-reference entity k)
</pre>
  <pre id="var-docstr">Fetch the entity or entities referrenced by the given key.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/index">index</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (index type &amp; keys)
</pre>
  <pre id="var-docstr">Associate an index with a give type.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/list-indexes">list-indexes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (list-indexes type)
</pre>
  <pre id="var-docstr"></pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/make">make</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (make type hmap)
</pre>
  <pre id="var-docstr">Converts a hashmap to the supplied type.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/save">save</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (save entity)
       (save entity &amp; entities)
</pre>
  <pre id="var-docstr">Inserts or updates one or more entities.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/set-reference">set-reference</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (set-reference entity k v)
</pre>
  <pre id="var-docstr">Set an :_id to the key of the given entity</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="karras.document/update">update</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (update entity)
       (update entity &amp; entities)
</pre>
  <pre id="var-docstr">Inserts or updates one or more entities.</pre>
  
</div>


</div>
              </div>
            </div>
          </div>
	</div>
	<div id="foot">
	  <div style="text-align: center;" id="copyright">No copyright info </div>
	</div>
      </div>
      <div id="DesignedBy">Logo &amp; site design by <a title="Visit Tom Hickey's website." href="http://www.tomhickey.com">Tom Hickey</a>.<br />
      Clojure auto-documentation system by Tom Faulhaber.</div>
    </div>
    <!-- /AllContentContainer -->
  </body>

</html>